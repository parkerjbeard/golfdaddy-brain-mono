# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Memories

- All new md docs generated by claude are put in the folder in the root "claude_docs"
- When updating TODO lists, remove completed items instead of checking them off

## Authentication System (January 2025)

### Overview
The authentication system uses a hybrid approach:
- **Supabase**: Handles authentication only (login/logout, JWT tokens)
- **PostgreSQL**: Stores user profiles and roles separately from Supabase
- **Roles**: Simple string-based roles (`employee`, `manager`, `admin`)

### Key Features
1. **Separation of concerns** - Supabase for auth, PostgreSQL for app data
2. **Cached roles** - User profile/role cached in localStorage for 5 minutes
3. **Simple role checks** - No complex JWT modifications or Supabase role integration
4. **Fast performance** - Role checks use cached data, no API calls needed

### Implementation Details

#### Backend
- User model uses enum: `employee`, `manager`, `admin`
- `/api/auth/me` endpoint returns user profile with role
- Role protection via dependencies:
  - `get_current_user()` - Any authenticated user
  - `get_manager_or_admin_user()` - Managers and admins only
  - `get_admin_user()` - Admins only

#### Frontend
- `AuthContext` provides session and cached user profile
- `ProtectedRoute` component for role-based route protection
- Helper hooks: `useIsAdmin()`, `useIsManager()`, `useIsEmployee()`
- Role cached in localStorage with 5-minute TTL

### Key Files
- `frontend/src/contexts/AuthContext.tsx` - Auth context with role caching
- `frontend/src/components/ProtectedRoute.tsx` - Role-based route protection
- `frontend/src/components/Layout.tsx` - Navigation with role-based menu items
- `backend/app/auth/dependencies.py` - Backend role verification
- `backend/migrations/add_user_roles.sql` - Database migration for roles

[Rest of the document remains the same...]