# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Memories

- All new md docs generated by claude are put in the folder in the root "claude_docs"

## Authentication Fix (January 2025)

### Problem
The original authentication implementation was causing browser crashes due to:
1. **Infinite retry loops** in `fetchUserProfile` function - retrying failed API calls 5 times with 2-second delays
2. **Complex auth state management** with multiple overlapping auth listeners
3. **Circular dependencies** between auth hooks and API initialization
4. **Race conditions** between Supabase auth and backend API calls

### Solution
Created a simplified authentication flow that:
1. **Uses Supabase directly** without complex wrappers or retry logic
2. **No API calls during auth** - just creates basic user object from Supabase session
3. **Single auth state source** - one useEffect for session management
4. **Simple protected routes** - checks session exists before rendering protected content

### Implementation
- Created `SimpleAppWithRoutes.tsx` that combines working auth with all dashboard pages
- Uses the exact same Supabase pattern that worked in test HTML page
- Wraps each route with `SimpleProtectedRoute` for auth checks
- Uses original `Layout` component to maintain proper UI structure

### Key Files
- `frontend/src/SimpleAppWithRoutes.tsx` - Main app with working auth
- `frontend/src/hooks/useAuthSimplified.tsx` - Simplified auth hook without retry logic
- Removed usage of `initializeApi()` which was causing startup issues

[Rest of the document remains the same...]